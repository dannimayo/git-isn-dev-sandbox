<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>Email_to_Update_Event_Notes</name>
        <label>Email to Update Event Notes</label>
        <locationX>601</locationX>
        <locationY>438</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <connector>
            <targetReference>Check_1_Day_Complete</targetReference>
        </connector>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <elementReference>EmailBody</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <stringValue>Update Notes for Meeting with {!Account.Name}</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailAddresses</name>
            <value>
                <stringValue>{!User.Email},{!User.ManagerEmail__c}</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderAddress</name>
            <value>
                <stringValue>sfsupport@isn.com</stringValue>
            </value>
        </inputParameters>
    </actionCalls>
    <assignments>
        <name>Check_1_Day_Complete</name>
        <label>Check 1 Day Complete</label>
        <locationX>444</locationX>
        <locationY>528</locationY>
        <assignmentItems>
            <assignToReference>x1DayEvent</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>WaittoActivityDate</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Check_1_Hour_Complete</name>
        <label>Check 1 Hour Complete</label>
        <locationX>266</locationX>
        <locationY>527</locationY>
        <assignmentItems>
            <assignToReference>x1HourEvent</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>WaittoActivityDate</targetReference>
        </connector>
    </assignments>
    <description>Sends follow up email day after event with reminder to update notes, add green sheet, and send thank you card as applicable</description>
    <formulas>
        <name>ActivityDatePlus7</name>
        <dataType>Date</dataType>
        <expression>DateValue({!Event.EndDateTime}) + 7</expression>
    </formulas>
    <formulas>
        <name>mhiGSRequiredText</name>
        <dataType>String</dataType>
        <expression>If({!Event.mhiGSrequired__c}=True,&#39; upload a copy of the Green Sheet and&#39;,&#39;&#39;)</expression>
    </formulas>
    <formulas>
        <name>SendThankYouCard</name>
        <dataType>String</dataType>
        <expression>IF(Text({!Event.Format__c})=&#39;In-Person&#39;,&#39;If this meeting was in-person, please send a thank you card if appropriate.&#39;,&#39;&#39;)</expression>
    </formulas>
    <interviewLabel>Event Follow Up Email and Task {!$Flow.CurrentDateTime} EventId={!EventID}</interviewLabel>
    <label>Event Follow Up Email and Task</label>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <name>Add_Call_Task</name>
        <label>Add Call Task</label>
        <locationX>122</locationX>
        <locationY>433</locationY>
        <assignRecordIdToReference>TaskID</assignRecordIdToReference>
        <connector>
            <targetReference>Check_1_Hour_Complete</targetReference>
        </connector>
        <inputAssignments>
            <field>ActivityDate</field>
            <value>
                <elementReference>ActivityDatePlus7</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Activity_Type__c</field>
            <value>
                <stringValue>04 - Spoke with Contact/Lead</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>OwnerId</field>
            <value>
                <elementReference>Event.OwnerId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Site__c</field>
            <value>
                <elementReference>Event.Site__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Subject</field>
            <value>
                <stringValue>Follow Up with Contact About Meeting on {!Event.ActivityDate}</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>WhatId</field>
            <value>
                <elementReference>Event.WhatId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>WhoId</field>
            <value>
                <elementReference>Event.WhoId</elementReference>
            </value>
        </inputAssignments>
        <object>Task</object>
    </recordCreates>
    <recordLookups>
        <name>Account_Details</name>
        <label>Account Details</label>
        <locationX>637</locationX>
        <locationY>170</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Contact_Details</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Event.WhatId</elementReference>
            </value>
        </filters>
        <object>Account</object>
        <outputReference>Account</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Name</queriedFields>
        <queriedFields>Vertical_Team_Email__c</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Contact_Details</name>
        <label>Contact Details</label>
        <locationX>621</locationX>
        <locationY>310</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Email_to_Update_Event_Notes</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Event.WhoId</elementReference>
            </value>
        </filters>
        <object>Contact</object>
        <outputReference>Contact</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>FirstName</queriedFields>
        <queriedFields>LastName</queriedFields>
        <queriedFields>Name</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>NewEvent</name>
        <label>NewEvent</label>
        <locationX>66</locationX>
        <locationY>145</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>WaittoActivityDate</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>EventID</elementReference>
            </value>
        </filters>
        <object>Event</object>
        <outputReference>Event</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Subject</queriedFields>
        <queriedFields>ActivityDate</queriedFields>
        <queriedFields>CreatedById</queriedFields>
        <queriedFields>LastModifiedById</queriedFields>
        <queriedFields>WhoId</queriedFields>
        <queriedFields>WhatId</queriedFields>
        <queriedFields>Activity_Type__c</queriedFields>
        <queriedFields>OwnerId</queriedFields>
        <queriedFields>StartDateTime</queriedFields>
        <queriedFields>EndDateTime</queriedFields>
        <queriedFields>Site__c</queriedFields>
        <queriedFields>Add_Follow_Up_Call_Task__c</queriedFields>
        <queriedFields>mhiGSrequired__c</queriedFields>
        <queriedFields>Format__c</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>UserEmail</name>
        <label>UserEmail</label>
        <locationX>354</locationX>
        <locationY>32</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Update_User_Manager_Email</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Event.OwnerId</elementReference>
            </value>
        </filters>
        <object>User</object>
        <outputReference>User</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Email</queriedFields>
        <queriedFields>ManagerEmail__c</queriedFields>
        <queriedFields>FirstName</queriedFields>
    </recordLookups>
    <startElementReference>NewEvent</startElementReference>
    <status>Active</status>
    <subflows>
        <name>Update_User_Manager_Email</name>
        <label>Update User Manager Email</label>
        <locationX>627</locationX>
        <locationY>35</locationY>
        <connector>
            <targetReference>Account_Details</targetReference>
        </connector>
        <flowName>Update_Users_ManagerEmail_Field</flowName>
        <inputAssignments>
            <name>UserID</name>
            <value>
                <elementReference>User.Id</elementReference>
            </value>
        </inputAssignments>
        <outputAssignments>
            <assignToReference>UserID1</assignToReference>
            <name>UserID</name>
        </outputAssignments>
    </subflows>
    <textTemplates>
        <name>EmailBody</name>
        <text>{!User.FirstName},

Please update the description for the below meeting to include details about attendees, topics discussed, and any action items, if you have not already done so. 

Meeting: {!Event.Subject}
Account: {!Account.Name}
Contact: {!Contact.Name}

Click here to access in Salesforce: https://isn.my.salesforce.com/{!Event.Id}

{!SendThankYouCard}</text>
    </textTemplates>
    <variables>
        <name>Account</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>Account</objectType>
    </variables>
    <variables>
        <name>BaseTime</name>
        <dataType>Date</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>Contact</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>Contact</objectType>
    </variables>
    <variables>
        <name>Event</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>Event</objectType>
    </variables>
    <variables>
        <name>EventDeliveryStatus</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>EventID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>TaskID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>User</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>User</objectType>
    </variables>
    <variables>
        <name>UserID1</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>x1DayEvent</name>
        <dataType>Boolean</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <value>
            <booleanValue>false</booleanValue>
        </value>
    </variables>
    <variables>
        <name>x1HourEvent</name>
        <dataType>Boolean</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <value>
            <booleanValue>false</booleanValue>
        </value>
    </variables>
    <waits>
        <name>WaittoActivityDate</name>
        <label>Wait to Activity Date</label>
        <locationX>353</locationX>
        <locationY>296</locationY>
        <defaultConnectorLabel>[Default Path]</defaultConnectorLabel>
        <waitEvents>
            <name>X1_Day_After</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>x1DayEvent</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>UserEmail</targetReference>
            </connector>
            <eventType>DateRefAlarmEvent</eventType>
            <inputParameters>
                <name>EntityObjectId</name>
                <value>
                    <elementReference>Event.Id</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>TimeFieldColumnEnumOrId</name>
                <value>
                    <stringValue>EndDateTime</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>TimeTableColumnEnumOrId</name>
                <value>
                    <stringValue>Event</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>TimeOffsetUnit</name>
                <value>
                    <stringValue>Hours</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>TimeOffset</name>
                <value>
                    <numberValue>24.0</numberValue>
                </value>
            </inputParameters>
            <label>1 Day After</label>
            <outputParameters>
                <assignToReference>Event.EndDateTime</assignToReference>
                <name>AlarmTime</name>
            </outputParameters>
        </waitEvents>
        <waitEvents>
            <name>X1_Hour_After</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>x1HourEvent</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Event.Add_Follow_Up_Call_Task__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Add_Call_Task</targetReference>
            </connector>
            <eventType>DateRefAlarmEvent</eventType>
            <inputParameters>
                <name>EntityObjectId</name>
                <value>
                    <elementReference>Event.Id</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>TimeFieldColumnEnumOrId</name>
                <value>
                    <stringValue>EndDateTime</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>TimeTableColumnEnumOrId</name>
                <value>
                    <stringValue>Event</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>TimeOffsetUnit</name>
                <value>
                    <stringValue>Hours</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>TimeOffset</name>
                <value>
                    <numberValue>1.0</numberValue>
                </value>
            </inputParameters>
            <label>1 Hour After</label>
            <outputParameters>
                <assignToReference>Event.EndDateTime</assignToReference>
                <name>AlarmTime</name>
            </outputParameters>
        </waitEvents>
    </waits>
</Flow>
