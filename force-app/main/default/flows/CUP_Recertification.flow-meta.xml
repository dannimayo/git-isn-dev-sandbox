<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <actionCalls>
        <name>Notify_ClientDev</name>
        <label>Notify ClientDev</label>
        <locationX>1058</locationX>
        <locationY>387</locationY>
        <actionName>Certificate__c.Contractor_CUP_Recertification_Entered</actionName>
        <actionType>emailAlert</actionType>
        <connector>
            <targetReference>Thank_you</targetReference>
        </connector>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <choices>
        <name>choiceAttendConference</name>
        <choiceText>Attend ISN Conference/Event</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Attend ISN Conference/Event</stringValue>
        </value>
    </choices>
    <choices>
        <name>choiceAttendMeeting</name>
        <choiceText>Attend ISN Meeting</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Attend ISN Meeting</stringValue>
        </value>
    </choices>
    <choices>
        <name>choiceAttendUGM</name>
        <choiceText>Attend an ISN Users Group Meeting</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Attend an ISN Users Group Meeting</stringValue>
        </value>
    </choices>
    <choices>
        <name>choiceHostUGM</name>
        <choiceText>Co-host ISN UGM/HD</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Co-host ISN UGM/HD</stringValue>
        </value>
    </choices>
    <choices>
        <name>choiceTestimonial</name>
        <choiceText>Draft a Testimonial Letter or Success Story</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Draft a Testimonial Letter or Success Story</stringValue>
        </value>
    </choices>
    <choices>
        <name>choiceUsability</name>
        <choiceText>Participate in Usability Session</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Participate in Usability Session</stringValue>
        </value>
    </choices>
    <choices>
        <name>choiceWebcast</name>
        <choiceText>View a Live Webcast Training</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>View a Live Webcast Training</stringValue>
        </value>
    </choices>
    <decisions>
        <name>Hiring_Client_or_Contractor</name>
        <label>Hiring Client or Contractor?</label>
        <locationX>555</locationX>
        <locationY>40</locationY>
        <defaultConnector>
            <targetReference>HC_CUP_Recertification_Type</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Hiring Client</defaultConnectorLabel>
        <rules>
            <name>Contractor</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Certificate.Type__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Certified User - Contractor</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>CE_Recertification_Type</targetReference>
            </connector>
            <label>Contractor</label>
        </rules>
    </decisions>
    <description>Re-working recertification so it sits on the record detail page.</description>
    <dynamicChoiceSets>
        <name>certificateType</name>
        <dataType>String</dataType>
        <displayField>Type__c</displayField>
        <object>Certificate__c</object>
    </dynamicChoiceSets>
    <dynamicChoiceSets>
        <name>recertificationHiringClient</name>
        <dataType>Picklist</dataType>
        <displayField xsi:nil="true"/>
        <object xsi:nil="true"/>
        <picklistField>Type__c</picklistField>
        <picklistObject>Certificate_Credit__c</picklistObject>
        <sortOrder>Asc</sortOrder>
    </dynamicChoiceSets>
    <formulas>
        <name>currentYear</name>
        <dataType>String</dataType>
        <expression>TEXT(YEAR(TODAY()))</expression>
    </formulas>
    <formulas>
        <name>renewExpiration</name>
        <dataType>Date</dataType>
        <expression>IF(
(
YEAR(
{!Get_Certificate.Expiration_Date__c})=YEAR(TODAY())),
DATE((YEAR({!Get_Certificate.Expiration_Date__c} )+1),12,31),
{!Get_Certificate.Expiration_Date__c}
)</expression>
    </formulas>
    <formulas>
        <name>userContactId</name>
        <dataType>String</dataType>
        <expression>If(
{!isTest} = True,
{!manualUserContactId},
{!$User.ContactId}
)</expression>
    </formulas>
    <formulas>
        <name>userEmail</name>
        <dataType>String</dataType>
        <expression>{!$User.Email}</expression>
    </formulas>
    <formulas>
        <name>userFirstName</name>
        <dataType>String</dataType>
        <expression>{!$User.FirstName}</expression>
    </formulas>
    <formulas>
        <name>userLastName</name>
        <dataType>String</dataType>
        <expression>{!$User.LastName}</expression>
    </formulas>
    <interviewLabel>CUP Recertification {!$Flow.CurrentDateTime}</interviewLabel>
    <label>CUP Recertification</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>Flow</processType>
    <recordCreates>
        <name>Create_Contractor_Cert_Credit</name>
        <label>Create Contractor Cert Credit</label>
        <locationX>886</locationX>
        <locationY>49</locationY>
        <connector>
            <targetReference>Update_Certificate_Expiration</targetReference>
        </connector>
        <faultConnector>
            <targetReference>Record_Didn_t_Create_0</targetReference>
        </faultConnector>
        <inputAssignments>
            <field>Certificate__c</field>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Credit_Applied__c</field>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Credit_Date__c</field>
            <value>
                <elementReference>Event_Date_Ce</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Email__c</field>
            <value>
                <elementReference>userEmail</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>First_Name__c</field>
            <value>
                <elementReference>userFirstName</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Last_Name__c</field>
            <value>
                <elementReference>userLastName</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Notes__c</field>
            <value>
                <elementReference>recertNotesCE</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Status__c</field>
            <value>
                <stringValue>Approved</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Type__c</field>
            <value>
                <elementReference>Recertification_Type_Ce</elementReference>
            </value>
        </inputAssignments>
        <object>Certificate_Credit__c</object>
    </recordCreates>
    <recordCreates>
        <name>Create_Hiring_Client_Cert_Credit</name>
        <label>Create Hiring Client Cert Credit</label>
        <locationX>880</locationX>
        <locationY>392</locationY>
        <assignRecordIdToReference>certCreditId</assignRecordIdToReference>
        <connector>
            <targetReference>Notify_ClientDev</targetReference>
        </connector>
        <faultConnector>
            <targetReference>Record_Didn_t_Create</targetReference>
        </faultConnector>
        <inputAssignments>
            <field>Certificate__c</field>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Credit_Date__c</field>
            <value>
                <elementReference>Event_Date</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Email__c</field>
            <value>
                <elementReference>userEmail</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>First_Name__c</field>
            <value>
                <elementReference>userFirstName</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Last_Name__c</field>
            <value>
                <elementReference>userLastName</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Notes__c</field>
            <value>
                <elementReference>Notes</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Status__c</field>
            <value>
                <stringValue>Pending</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Type__c</field>
            <value>
                <elementReference>Recertification_Type</elementReference>
            </value>
        </inputAssignments>
        <object>Certificate_Credit__c</object>
    </recordCreates>
    <recordLookups>
        <name>Get_Certificate</name>
        <label>Get Certificate</label>
        <locationX>388</locationX>
        <locationY>38</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Hiring_Client_or_Contractor</targetReference>
        </connector>
        <faultConnector>
            <targetReference>certificate_not_found</targetReference>
        </faultConnector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Certificate__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>Update_Certificate_Expiration</name>
        <label>Update Certificate Expiration</label>
        <locationX>1055</locationX>
        <locationY>48</locationY>
        <connector>
            <targetReference>Thank_you_ce</targetReference>
        </connector>
        <faultConnector>
            <targetReference>Record_Didn_t_Create_0</targetReference>
        </faultConnector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Expiration_Date__c</field>
            <value>
                <elementReference>renewExpiration</elementReference>
            </value>
        </inputAssignments>
        <object>Certificate__c</object>
    </recordUpdates>
    <recordUpdates>
        <name>updateTeamEmail</name>
        <label>updateTeamEmail</label>
        <locationX>707</locationX>
        <locationY>392</locationY>
        <connector>
            <targetReference>Create_Hiring_Client_Cert_Credit</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Team_Email__c</field>
            <value>
                <elementReference>Get_Certificate.Formula_Team_Email__c</elementReference>
            </value>
        </inputAssignments>
        <object>Certificate__c</object>
    </recordUpdates>
    <screens>
        <name>CE_Recertification_Type</name>
        <label>CE Recertification Type</label>
        <locationX>736</locationX>
        <locationY>51</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>Create_Contractor_Cert_Credit</targetReference>
        </connector>
        <fields>
            <name>recertificationTypeCE</name>
            <fieldText>&lt;p&gt;Please select the type of recertification event you complete this year along with the date completed.&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b style=&quot;color: rgb(62, 62, 60); background-color: rgb(255, 255, 255);&quot;&gt;The event date must be in this calendar year ({!currentYear}).&lt;/b&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>Recertification_Type_Ce</name>
            <choiceReferences>choiceUsability</choiceReferences>
            <choiceReferences>choiceAttendMeeting</choiceReferences>
            <choiceReferences>choiceWebcast</choiceReferences>
            <choiceReferences>choiceAttendUGM</choiceReferences>
            <choiceReferences>choiceTestimonial</choiceReferences>
            <dataType>String</dataType>
            <fieldText>Recertification Type</fieldText>
            <fieldType>DropdownBox</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>Event_Date_Ce</name>
            <dataType>Date</dataType>
            <fieldText>Event Date (mm/dd/yyyy)</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>true</isRequired>
            <validationRule>
                <errorMessage>&lt;p&gt;To qualify for recertification the event must have already happened within this calendar year.&lt;/p&gt;</errorMessage>
                <formulaExpression>AND(YEAR({!Event_Date_Ce}) = YEAR(TODAY()),{!Event_Date_Ce}&lt;TODAY())</formulaExpression>
            </validationRule>
        </fields>
        <fields>
            <name>recertNotesCE</name>
            <dataType>String</dataType>
            <fieldText>Notes (if applicable)</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>false</isRequired>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>certificate_not_found</name>
        <label>Certificate Not Found</label>
        <locationX>382</locationX>
        <locationY>246</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <fields>
            <name>instructions_0</name>
            <fieldText>&lt;p&gt;We were unable to find your certificate. Please contact ISN&#39;s certified user team at CUP@isn.com.&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>Certified_User_Recertification</name>
        <label>Certified User Recertification</label>
        <locationX>182</locationX>
        <locationY>40</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>Get_Certificate</targetReference>
        </connector>
        <fields>
            <name>instructions</name>
            <fieldText>&lt;p&gt;Click next to begin entering your recertification information for the ISN Certified User program.&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>HC_CUP_Recertification_Type</name>
        <label>HC Recertification Type</label>
        <locationX>550</locationX>
        <locationY>396</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>updateTeamEmail</targetReference>
        </connector>
        <fields>
            <name>recertificationType</name>
            <fieldText>&lt;p&gt;Please select the type of recertification event you completed this year along with the date completed.&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b style=&quot;color: rgb(62, 62, 60); background-color: rgb(255, 255, 255);&quot;&gt;The event date must be in this calendar year ({!currentYear}).&lt;/b&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>Recertification_Type</name>
            <choiceReferences>choiceHostUGM</choiceReferences>
            <choiceReferences>choiceAttendConference</choiceReferences>
            <choiceReferences>choiceUsability</choiceReferences>
            <choiceReferences>choiceAttendMeeting</choiceReferences>
            <dataType>String</dataType>
            <fieldText>Recertification Type</fieldText>
            <fieldType>DropdownBox</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>Event_Date</name>
            <dataType>Date</dataType>
            <fieldText>Event Date (mm/dd/yyyy)</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>true</isRequired>
            <validationRule>
                <errorMessage>&lt;p&gt;To qualify for recertification the event must have already happened within this calendar year.&lt;/p&gt;</errorMessage>
                <formulaExpression>AND(YEAR({!Event_Date}) = YEAR(TODAY()),{!Event_Date}&lt;TODAY())</formulaExpression>
            </validationRule>
        </fields>
        <fields>
            <name>Notes</name>
            <dataType>String</dataType>
            <fieldText>Notes (if applicable)</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>false</isRequired>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>Record_Didn_t_Create</name>
        <label>Record Didn&#39;t Create</label>
        <locationX>875</locationX>
        <locationY>645</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <fields>
            <name>contactRep</name>
            <fieldText>&lt;p&gt;There was an error entering your recertification method. Please contact your account representative.&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>Record_Didn_t_Create_0</name>
        <label>Record Didn&#39;t Create</label>
        <locationX>981</locationX>
        <locationY>258</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <fields>
            <name>contactRep_0</name>
            <fieldText>&lt;p&gt;There was an error entering your recertification method. Please contact the ISN Certified User Program Team at ContractorCUP@isn.com.&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>Thank_you</name>
        <label>Thank you</label>
        <locationX>1278</locationX>
        <locationY>389</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <fields>
            <name>thankYouText</name>
            <fieldText>&lt;p&gt;Thank you for entering your recertification information. Your account representative will review this request and you will be notified once processed.&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Please reach out to your account representative with any questions.&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>Thank_you_ce</name>
        <label>Thank you</label>
        <locationX>1257</locationX>
        <locationY>39</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <fields>
            <name>thankYouText_0</name>
            <fieldText>&lt;p&gt;Thank you for entering your recertification information. The ISN Certified User Program Team will be in touch next year regarding recertification.&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;If you have any questions please email ContractorCUP@isn.com.&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <start>
        <locationX>70</locationX>
        <locationY>40</locationY>
        <connector>
            <targetReference>Certified_User_Recertification</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <variables>
        <name>awardedTo</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Contact</objectType>
    </variables>
    <variables>
        <name>certCreditId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>emailSfNoReply</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <stringValue>SalesforceNoReply@isn.com</stringValue>
        </value>
    </variables>
    <variables>
        <name>isTest</name>
        <dataType>Boolean</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <value>
            <booleanValue>false</booleanValue>
        </value>
    </variables>
    <variables>
        <name>manualUserContactId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>manualUserId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>recordId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
