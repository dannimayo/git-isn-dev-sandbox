<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>Expired_CE</name>
        <label>Expired CE</label>
        <locationX>1335</locationX>
        <locationY>918</locationY>
        <actionName>Certificate__c.Contractor_CUP_Expired</actionName>
        <actionType>emailAlert</actionType>
        <connector>
            <targetReference>Loop_GetCertificatesCollection_0_0</targetReference>
        </connector>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>Temp_Certificate.Id</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <actionCalls>
        <name>Expired_HC</name>
        <label>Expired HC</label>
        <locationX>1006</locationX>
        <locationY>913</locationY>
        <actionName>Certificate__c.Hiring_Client_CUP_Expired</actionName>
        <actionType>emailAlert</actionType>
        <connector>
            <targetReference>Loop_GetCertificatesCollection_0_0</targetReference>
        </connector>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>Temp_Certificate.Id</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <actionCalls>
        <name>Final_Reminder_CE</name>
        <label>Final Reminder CE</label>
        <locationX>1368</locationX>
        <locationY>504</locationY>
        <actionName>Certificate__c.Contractor_CUP_Final_Recert_Reminders</actionName>
        <actionType>emailAlert</actionType>
        <connector>
            <targetReference>Loop_GetCertificatesCollection_0</targetReference>
        </connector>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>Temp_Certificate.Id</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <actionCalls>
        <name>Final_Reminder_HC</name>
        <label>Final Reminder HC</label>
        <locationX>1008</locationX>
        <locationY>508</locationY>
        <actionName>Certificate__c.Hiring_Client_CUP_Final_Recert_Reminder</actionName>
        <actionType>emailAlert</actionType>
        <connector>
            <targetReference>Loop_GetCertificatesCollection_0</targetReference>
        </connector>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>Temp_Certificate.Id</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <actionCalls>
        <name>Reminder_CE</name>
        <label>Reminder CE</label>
        <locationX>1416</locationX>
        <locationY>165</locationY>
        <actionName>Certificate__c.Contractor_CUP_Recert_Reminders</actionName>
        <actionType>emailAlert</actionType>
        <connector>
            <targetReference>Loop_GetCertificatesCollection</targetReference>
        </connector>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>Temp_Certificate.Id</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <actionCalls>
        <name>Reminder_HC</name>
        <label>Reminder HC</label>
        <locationX>1024</locationX>
        <locationY>156</locationY>
        <actionName>Certificate__c.Hiring_Client_CUP_Recert_Reminders</actionName>
        <actionType>emailAlert</actionType>
        <connector>
            <targetReference>Loop_GetCertificatesCollection</targetReference>
        </connector>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>Temp_Certificate.Id</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <assignments>
        <name>Assign_Team_Email</name>
        <label>Assign Team Email</label>
        <locationX>463</locationX>
        <locationY>221</locationY>
        <assignmentItems>
            <assignToReference>Temp_Certificate.Team_Email__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Temp_Certificate.Formula_Team_Email__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>AssignCertsUpdated</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Team_Email_0</name>
        <label>Assign Team Email</label>
        <locationX>475</locationX>
        <locationY>575</locationY>
        <assignmentItems>
            <assignToReference>Temp_Certificate.Team_Email__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Temp_Certificate.Formula_Team_Email__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>AssignFinalCertsUpdated</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Team_Email_0_0</name>
        <label>Assign Team Email</label>
        <locationX>477</locationX>
        <locationY>979</locationY>
        <assignmentItems>
            <assignToReference>Temp_Certificate.Team_Email__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Temp_Certificate.Formula_Team_Email__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>Temp_Certificate.Status__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Expired</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>Temp_Certificate.Expiration_Reason__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Certificate credits were not entered prior to expiration date passing</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>AssignExpiredCertsUpdated</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>AssignCertsUpdated</name>
        <label>AssignCertsUpdated</label>
        <locationX>325</locationX>
        <locationY>219</locationY>
        <assignmentItems>
            <assignToReference>CertsUpdated</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Temp_Certificate</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_GetCertificatesCollection_Update</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>AssignExpiredCertsUpdated</name>
        <label>AssignExpiredCertsUpdated</label>
        <locationX>327</locationX>
        <locationY>974</locationY>
        <assignmentItems>
            <assignToReference>ExpiredCertsUpdated</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Temp_Certificate</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_GetCertificatesCollection_Update_0_0</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>AssignFinalCertsUpdated</name>
        <label>AssignFinalCertsUpdated</label>
        <locationX>333</locationX>
        <locationY>577</locationY>
        <assignmentItems>
            <assignToReference>FinalCertsUpdated</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Temp_Certificate</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_GetCertificatesCollection_Update_0</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Email_Reminder_to</name>
        <label>Email Reminder to</label>
        <locationX>741</locationX>
        <locationY>331</locationY>
        <defaultConnector>
            <targetReference>Reminder_CE</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Contractor</defaultConnectorLabel>
        <rules>
            <name>Hiring_Client_Email</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Temp_Certificate.Type__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Certified User Hiring Client</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Reminder_HC</targetReference>
            </connector>
            <label>Hiring Client</label>
        </rules>
    </decisions>
    <decisions>
        <name>Email_Reminder_to_0</name>
        <label>Email Reminder to</label>
        <locationX>742</locationX>
        <locationY>585</locationY>
        <defaultConnector>
            <targetReference>Final_Reminder_CE</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Contractor</defaultConnectorLabel>
        <rules>
            <name>Hiring_Client_Email2</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Temp_Certificate.Type__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Certified User Hiring Client</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Final_Reminder_HC</targetReference>
            </connector>
            <label>Hiring Client</label>
        </rules>
    </decisions>
    <decisions>
        <name>Email_Reminder_to_0_0</name>
        <label>Email Reminder to</label>
        <locationX>815</locationX>
        <locationY>1001</locationY>
        <defaultConnector>
            <targetReference>Expired_CE</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Contractor</defaultConnectorLabel>
        <rules>
            <name>Hiring_Client_Email3</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Temp_Certificate.Type__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Certified User Hiring Client</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Expired_HC</targetReference>
            </connector>
            <label>Hiring Client</label>
        </rules>
    </decisions>
    <decisions>
        <name>Run_on_this_Date</name>
        <label>Run on this Date</label>
        <locationX>43</locationX>
        <locationY>593</locationY>
        <defaultConnectorLabel>Don&#39;t Run on this Date</defaultConnectorLabel>
        <rules>
            <name>Apr_15_Jul_15</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>dateToday</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>dateQ2</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>dateToday</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>dateQ3</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>GetCertificates</targetReference>
            </connector>
            <label>Apr 15, Jul 15</label>
        </rules>
        <rules>
            <name>Oct_15</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>dateToday</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>dateQ4</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>GetCertificates_Final</targetReference>
            </connector>
            <label>Oct 15</label>
        </rules>
        <rules>
            <name>Dec_31</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>dateToday</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>dateExpirationThisYear</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>GetCertificates_Expiration</targetReference>
            </connector>
            <label>Dec 31</label>
        </rules>
    </decisions>
    <formulas>
        <name>dateExpirationThisYear</name>
        <dataType>Date</dataType>
        <expression>Date(YEAR(TODAY()),12,31)</expression>
    </formulas>
    <formulas>
        <name>dateQ1</name>
        <dataType>Date</dataType>
        <expression>Date(YEAR(TODAY()),1,15)</expression>
    </formulas>
    <formulas>
        <name>dateQ2</name>
        <dataType>Date</dataType>
        <expression>Date(YEAR(TODAY()),4,15)</expression>
    </formulas>
    <formulas>
        <name>dateQ3</name>
        <dataType>Date</dataType>
        <expression>Date(YEAR(TODAY()),7,15)</expression>
    </formulas>
    <formulas>
        <name>dateQ4</name>
        <dataType>Date</dataType>
        <expression>Date(YEAR(TODAY()),10,15)</expression>
    </formulas>
    <formulas>
        <name>dateToday</name>
        <dataType>Date</dataType>
        <expression>Today()</expression>
    </formulas>
    <interviewLabel>CUP Expiration and Recertification Emails {!$Flow.CurrentDateTime}</interviewLabel>
    <label>CUP Expiration and Recertification Emails</label>
    <loops>
        <name>Loop_GetCertificatesCollection</name>
        <label>Loop_GetCertificatesCollection</label>
        <locationX>751</locationX>
        <locationY>69</locationY>
        <assignNextValueToReference>Temp_Certificate</assignNextValueToReference>
        <collectionReference>CertsUpdated</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Email_Reminder_to</targetReference>
        </nextValueConnector>
    </loops>
    <loops>
        <name>Loop_GetCertificatesCollection_0</name>
        <label>Loop_GetCertificatesCollection</label>
        <locationX>754</locationX>
        <locationY>441</locationY>
        <assignNextValueToReference>Temp_Certificate</assignNextValueToReference>
        <collectionReference>FinalCertsUpdated</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Email_Reminder_to_0</targetReference>
        </nextValueConnector>
    </loops>
    <loops>
        <name>Loop_GetCertificatesCollection_0_0</name>
        <label>Loop_GetCertificatesCollection</label>
        <locationX>818</locationX>
        <locationY>814</locationY>
        <assignNextValueToReference>Temp_Certificate</assignNextValueToReference>
        <collectionReference>ExpiredCertsUpdated</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Email_Reminder_to_0_0</targetReference>
        </nextValueConnector>
    </loops>
    <loops>
        <name>Loop_GetCertificatesCollection_Update</name>
        <label>Loop_GetCertificatesCollectionUpdate</label>
        <locationX>381</locationX>
        <locationY>70</locationY>
        <assignNextValueToReference>Temp_Certificate</assignNextValueToReference>
        <collectionReference>GetCertificates</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Assign_Team_Email</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Update_Team_Email</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loop_GetCertificatesCollection_Update_0</name>
        <label>Loop_GetCertificatesCollectionUpdate</label>
        <locationX>396</locationX>
        <locationY>417</locationY>
        <assignNextValueToReference>Temp_Certificate</assignNextValueToReference>
        <collectionReference>GetCertificates_Final</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Assign_Team_Email_0</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Update_Team_Email_0</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loop_GetCertificatesCollection_Update_0_0</name>
        <label>Loop_GetCertificatesCollectionUpdate</label>
        <locationX>398</locationX>
        <locationY>810</locationY>
        <assignNextValueToReference>Temp_Certificate</assignNextValueToReference>
        <collectionReference>GetCertificates_Expiration</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Assign_Team_Email_0_0</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Update_Team_Email_0_0</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <name>GetCertificates</name>
        <label>GetCertificates</label>
        <locationX>165</locationX>
        <locationY>62</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_GetCertificatesCollection_Update</targetReference>
        </connector>
        <filters>
            <field>Expires_This_Year__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Status__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Current</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Certificate__c</object>
        <queriedFields>Id</queriedFields>
        <queriedFields>Type__c</queriedFields>
        <queriedFields>Formula_Team_Email__c</queriedFields>
        <queriedFields>Team_Email__c</queriedFields>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>GetCertificates_Expiration</name>
        <label>GetCertificatesExpiration</label>
        <locationX>186</locationX>
        <locationY>808</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_GetCertificatesCollection_Update_0_0</targetReference>
        </connector>
        <filters>
            <field>Expiration_Date__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>dateToday</elementReference>
            </value>
        </filters>
        <filters>
            <field>Expires_This_Year__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Status__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Current</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Certificate__c</object>
        <queriedFields>Id</queriedFields>
        <queriedFields>Type__c</queriedFields>
        <queriedFields>Formula_Team_Email__c</queriedFields>
        <queriedFields>Team_Email__c</queriedFields>
        <queriedFields>Expiration_Reason__c</queriedFields>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>GetCertificates_Final</name>
        <label>GetCertificatesFinal</label>
        <locationX>188</locationX>
        <locationY>416</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_GetCertificatesCollection_Update_0</targetReference>
        </connector>
        <filters>
            <field>Expires_This_Year__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Status__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Current</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Certificate__c</object>
        <queriedFields>Id</queriedFields>
        <queriedFields>Type__c</queriedFields>
        <queriedFields>Formula_Team_Email__c</queriedFields>
        <queriedFields>Team_Email__c</queriedFields>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>Update_Team_Email</name>
        <label>Update Team Email</label>
        <locationX>589</locationX>
        <locationY>76</locationY>
        <connector>
            <targetReference>Loop_GetCertificatesCollection</targetReference>
        </connector>
        <inputReference>CertsUpdated</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Team_Email_0</name>
        <label>Update Team Email</label>
        <locationX>597</locationX>
        <locationY>419</locationY>
        <connector>
            <targetReference>Loop_GetCertificatesCollection_0</targetReference>
        </connector>
        <inputReference>FinalCertsUpdated</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Team_Email_0_0</name>
        <label>Update Team Email</label>
        <locationX>627</locationX>
        <locationY>813</locationY>
        <connector>
            <targetReference>Loop_GetCertificatesCollection_0_0</targetReference>
        </connector>
        <inputReference>ExpiredCertsUpdated</inputReference>
    </recordUpdates>
    <start>
        <locationX>58</locationX>
        <locationY>50</locationY>
        <connector>
            <targetReference>Run_on_this_Date</targetReference>
        </connector>
        <schedule>
            <frequency>Daily</frequency>
            <startDate>2019-12-16</startDate>
            <startTime>09:00:00.000Z</startTime>
        </schedule>
        <triggerType>Scheduled</triggerType>
    </start>
    <status>Active</status>
    <variables>
        <name>CertsUpdated</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Certificate__c</objectType>
    </variables>
    <variables>
        <name>ExpiredCertsUpdated</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Certificate__c</objectType>
    </variables>
    <variables>
        <name>FinalCertsUpdated</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Certificate__c</objectType>
    </variables>
    <variables>
        <name>Temp_Certificate</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Certificate__c</objectType>
    </variables>
</Flow>
